var fe=()=>{},Ke=String.fromCharCode,{from:Le,isArray:J,of:Ye}=Array,{MAX_VALUE:Ge,NEGATIVE_INFINITY:He,POSITIVE_INFINITY:Xe,isFinite:ze,isInteger:Je,isNaN:Qe,parseFloat:We,parseInt:Ze}=Number,{random:$e}=Math,{assign:et,defineProperty:tt,entries:Q,fromEntries:st,keys:Ee,getPrototypeOf:rt,values:Ie}=Object,at=Date.now,{iterator:nt,toStringTag:lt}=Symbol,{assert:it,clear:_t,debug:ot,dir:dt,error:ut,log:ct,table:ht}=console,{now:gt}=performance,U=a=>a.prototype,F=a=>typeof a=="function",p=(a,e,...t)=>s=>a[e].bind(s,...t),W=(a,e,...t)=>a[e].bind(a,...t),P=U(Array),k=U(Map),V=U(Set),Z=p(P,"pop"),R=p(P,"push"),Se=p(P,"splice",0),we=p(P,"at",-1),D=p(V,"add"),$=p(V,"clear"),ee=p(V,"delete"),te=p(V,"has"),se=p(k,"clear"),q=p(k,"delete"),T=p(k,"get"),M=p(k,"set"),pt=Symbol(1),mt=Symbol(1),vt=Symbol(1),Ne=(a,e)=>a===e,Me=(a,e)=>!1,Te=a=>a===!1?Me:a??Ne,Ce=a=>{let e=a.length**.5;return a.reduce((t,s)=>t+s*(s+e),0)},bt=fe,A=a=>{let{newId:e,getId:t,setId:s,addEdge:l}=a;return class{constructor(i,{name:d,equals:g}={}){let f=e();s(f,this),this.id=f,this.rid=f,this.name=d,this.value=i,this.equals=Te(g)}get(i){return i&&l(this.id,i),this.value}set(i){let d=this.value;return!this.equals(d,this.value=F(i)?i(d):i)}run(i){return i?1:0}bindMethod(i){return W(this,i)}static create(...i){let d=new this(...i);return[d.id,d]}}},Fe=a=>{let e=a.runId;return class extends a.getClass(A){constructor(t,s){super(t,s)}set(t){return super.set(t)?(e(this.id),!0):!1}static create(t,s){let l=new this(t,s);return[l.id,l.bindMethod("get"),l.bindMethod("set")]}}},Ae=a=>class extends a.getClass(A){constructor(e,t){super(t?.value,t),this.fn=e,t?.defer===!1&&this.get()}get(e){return this.rid&&(this.run(),this.rid=0),super.get(e)}run(e){return super.set(this.fn(this.rid))?1:0}static create(e,t){let s=new this(e,t);return[s.id,s.bindMethod("get")]}},Pe=a=>{let e=a.runId;return class extends a.getClass(A){constructor(t,s){super(void 0,s),this.fn=t,s?.defer===!1&&this.set()}get(t){t&&(this.rid&&this.run(),super.get(t))}set(){return e(this.id)}run(t){let s=this.fn(this.rid)!==!1;return this.rid&&(this.rid=0),s?1:0}static create(t,s){let l=new this(t,s);return[l.id,l.bindMethod("get"),l.bindMethod("set")]}}},ke=(a,e)=>(e??=void 0,a??=void 0,a===e?.toString()),re=a=>class extends a.getClass(A){prev_parent=null;constructor(e,t,s={}){s.equals??=ke,super(e,s),t!==void 0&&(this.fn=F(t)?t:()=>t),(s?.defer??!1)===!1&&this.get()}get(e){return this.rid&&(this.run(),this.rid=0),super.get(e)}set(e){let t=this.value,s=t.nodeValue;return e=F(e)?e(s):e,this.setNodeValue(e),!this.equals(s,e)}getParentElement(){return this.value.parentElement}removeFromParentElement(){return!!this.getParentElement()?.removeChild(this.value)}appendToElement(e){e.appendChild(this.value)}getNodeValue(){return this.value.nodeValue}setNodeValue(e){let t=e==null;return this.value.nodeValue=t?null:e.toString()}detach(){let e=this.getParentElement();return e?(this.prev_parent=e,this.removeFromParentElement(),!0):!1}reattach(e){let t=this.prev_parent??e;return t?(this.appendToElement(t),!0):!1}},Ve=a=>{let e=a.onDelete;return class extends a.getClass(re){constructor(t,s){let l=s?.value??document.createTextNode("");super(l,t,s)}run(t){return this.set(this.fn(this.rid))?1:0}static create(t,s){let l=new this(t,s);return[l.id,l.bindMethod("get"),l.value]}}},qe=a=>class extends a.getClass(re){constructor(e,t,s){let l=typeof e=="string"?document.createAttribute(e):e;super(l,t,s)}run(e){return this.set(this.fn(this.rid))?1:0}getParentElement(){return this.value.ownerElement}removeFromParentElement(){return!!this.getParentElement()?.removeAttributeNode(this.value)}appendToElement(e){e.setAttributeNode(this.value)}setNodeValue(e){let t=this.getParentElement();return e==null?super.detach():t||this.reattach(),super.setNodeValue(e)}static create(e,t,s){let l=new this(e,t,s);return[l.id,l.bindMethod("get"),l.value]}},xe={svg:"http://www.w3.org/2000/svg"},Oe=a=>{let e=a.addClass(Ve),t=a.addClass(qe),s=[],l=R(s),i=Z(s),d=we(s),g=(h,m,...c)=>{m??={};let E=d();if(E)return f(xe[E],h,m,...c);let I=c.flatMap(v=>v instanceof Node?v:e(v)[2]),S=F(h),o=S?h(m):h===void 0?[]:document.createElement(h);if(J(o))o.push(...I);else{if(!S)for(let[v,x]of Q(m)){let w=document.createAttribute(v);o.setAttributeNode(w),t(w,x)}o.append(...I)}return o},f=(h,m,c,...E)=>{c??={};let I=document.createElementNS(h,m),S=E.flatMap(o=>o instanceof Node?o:e(o)[2]);for(let[o,v]of Q(c))I.setAttributeNode(t(o,v)[2]);return I.append(...S),I},C={push:l,pop:i,seek:d},y=g.bind(void 0,void 0);return[g,y,C]},je=class{addEdge;delEdge;newId;getId;setId;delId;runId;swapId;onInit;onDelete;clearCache;addClass;getClass;batch;dynamic;constructor(){let a=0,e=0,t=new Map,s=new Map,l=T(t),i=T(s),d=M(t),g=M(s),f=q(t),C=q(s),y=new Map,h=T(y),m=M(y),c=se(y),E=r=>{let n=new Set,_=D(n),u=te(n),b=N=>{u(N)||(l(N)?.forEach(b),_(N))};return r.forEach(b),r.forEach(ee(n)),[...n,...r].reverse()},I=(...r)=>{let n=Ce(r);return h(n)??(m(n,E(r))&&h(n))},S=new Map,o=T(S),v=M(S),x=q(S),w=new Set,B=D(w),ae=ee(w),ne=$(w),O=new Set,le=D(O),ie=te(O),_e=$(O),K=new Map,De=M(K),Be=se(K),L=[],oe=R(L),de=Z(L),Y=(...r)=>{ne(),_e(),r.forEach(B);let n=r.length,_=I(...r);for(let b of _){if(ae(b)&&!ie(b)){let N=ue(b,n-- >0);N!==0&&l(b)?.forEach(N>=1?B:le)}if(w.size<=0)break}let u;for(;u=de();)o(u)?.postrun()},ue=(r,n)=>{let _=n===!0,u=o(r),b=u?.run(_)??0;return b>=1&&u.postrun&&oe(r),b},G=[],ce=R(G),he=Se(G),H=()=>++e,X=()=>{--e<=0&&(e=0,Y(...he()))},ge=(r,...n)=>{H();let _=r(...n);return X(),_},j=new Map,pe=T(j),me=M(j),ve=q(j);this.onInit=(r,n)=>r?n():void 0,this.onDelete=(r,n)=>{r&&me(r,n)},this.addEdge=(r,n)=>{if(r+n<=0)return!1;let _=l(r)??(d(r,new Set)&&l(r));return _.has(n)?!1:(_.add(n),i(n)?.add(r)||g(n,new Set([r])),c(),!0)},this.delEdge=(r,n)=>l(r)?.delete(n)&&i(n)?.delete(r)?(c(),!0):!1,this.newId=()=>(c(),++a),this.getId=o,this.setId=v,this.delId=r=>{if(x(r)){let n=l(r),_=i(r);return n?.forEach(u=>{i(u)?.delete(r)}),_?.forEach(u=>{l(u)?.delete(r)}),n?.clear(),_?.clear(),f(r),C(r),c(),pe(r)?.(),ve(r),!0}return!1},this.swapId=(r,n)=>{let _=o(r),u=o(n);v(r,u),v(n,_),_&&(_.id=n,_.rid&&(_.rid=n)),u&&(u.id=r,u.rid&&(u.rid=r)),c()},this.clearCache=c,this.runId=r=>e<=0?(Y(r),!0):(ce(r),!1);let z=new Map,be=T(z),ye=M(z);this.addClass=r=>{let n=this.getClass(r);return W(n,"create")},this.getClass=r=>{let n=be(r);return n||(n=r(this),ye(r,n),n)},this.batch={startBatching:H,endBatching:X,scopedBatching:ge},this.dynamic={setValue:(r,n)=>{let _=o(r??0);_&&(_.value=n)},setEquals:(r,n)=>{let _=o(r??0);_&&(_.equals=n)},setFn:(r,n)=>{let _=o(r??0);_&&(_.fn=n)}}}},Ue=a=>class extends a.getClass(A){constructor(e={},t){let s=J(e),l=s?[]:{},i=s?[...e.keys()]:Ee(e),d=s?[...e.values()]:Ie(e);super([l],t),this.setItems(i,d,!1)}postrun(){this.value.splice(1)}set(e,t,s){return this.setItems([e],[t],s)}setItems(e,t,s){let l=this.equals,i=this.value,d=i.length,g=i[0],f=e.length;for(let y=0;y<f;y++){let h=e[y],m=g[h],c=t[y],E=g[h]=F(c)?c(m):c;!l(m,E)&&i.push(h)}let C=i.length;return!s&&C-d>0}delete(e,t){return this.deleteKeys([e],t)}deleteKeys(e,t){let s=this.value,l=s.length,i=s[0];for(let g of e)g in i&&(delete i[g],s.push(g));let d=s.length;return!t&&d-l>0}},Re=a=>{let e=a.runId;return class extends a.getClass(Ue){setItems(t,s,l){return super.setItems(t,s,l)?e(this.id):!1}deleteKeys(t,s){return super.deleteKeys(t,s)?e(this.id):!1}static create(t={},s){let l=new this(t,s);return[l.id,l.bindMethod("get"),l.bindMethod("set"),l.bindMethod("setItems"),l.bindMethod("delete"),l.bindMethod("deleteKeys")]}}};export{je as Context,Pe as EffectSignal_Factory,Ae as MemoSignal_Factory,Re as RecordStateSignal_Factory,Fe as StateSignal_Factory,Oe as createHyperScript};
