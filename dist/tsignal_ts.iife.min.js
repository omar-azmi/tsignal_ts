"use strict";(()=>{var{from:Oe,isArray:k,of:Le}=Array;var De=String.fromCharCode,Pe=Promise.resolve,{isInteger:we,MAX_VALUE:Ve,NEGATIVE_INFINITY:ke,POSITIVE_INFINITY:Be}=Number,{assign:Ae,keys:B,getPrototypeOf:Ce,values:q}=Object,oe=Date.now,{iterator:qe,toStringTag:Ge}=Symbol;var G=()=>{};var D=n=>n.prototype;var y=(n,o,...t)=>e=>n[o].bind(e,...t);var A=(n,o,...t)=>n[o].bind(n,...t),j=D(Array),H=D(Map),v=D(Set);var $=y(j,"pop"),K=y(j,"push");var z=y(j,"splice",0);var U=y(v,"add"),Y=y(v,"clear"),J=y(v,"delete");var W=y(v,"has");var N=y(H,"clear");var f=y(H,"get");var T=y(H,"set");var F=Symbol("a rejection by a throttled function"),X=(n,o)=>{let t=0;return(...e)=>{let r=oe();return r-t>n?(t=r,o(...e)):F}};var M=(n,o)=>n===o,O=(n,o)=>!1,Ee=(n,o)=>{let t=o===!1?O:o??M,e=X(n,t);return(r,i)=>{let d=e(r,i);return d===F?!0:d}},de=n=>{let o=n.length**.5;return n.reduce((t,e)=>t+e*(e+o),0)},le=0?(n,o,t)=>{let e=n(o),r=t?n(t):{name:"untracked"};console.log("GET:	",e.name,"	by OBSERVER:	",r.name,"	with VALUE	",e.value)}:G;var Q=class{addEdge;delEdge;newId;getId;setId;delId;runId;addClass;getClass;batch;dynamic;constructor(){let o=0,t=0,e=new Map,r=new Map,i=f(e),d=f(r),c=T(e),_=T(r),u=new Map,C=f(u),S=T(u),x=N(u),R=a=>{let s=new Set,l=U(s),I=W(s),p=h=>{I(h)||(l(h),i(h)?.forEach(p))};return a.forEach(p),s},b=(...a)=>{let s=de(a);return C(s)??(S(s,R(a))&&C(s))},E=new Map,m=f(E),_e=T(E),L=new Set,pe=U(L),ye=J(L),ue=Y(L),P=new Map,fe=f(P),Te=T(P),me=N(P),w=[],ge=K(w),Se=$(w),ee=[],te=K(ee),he=z(ee),re=(...a)=>{ue(),me(),b(...a).forEach(pe);for(let l of a)V(l,!0);0&&console.log("UPDATE_POSTRUNS:	",w);let s;for(;s=Se();)m(s)?.postrun()},ne=()=>++t,ae=()=>{--t<=0&&(t=0,re(...he()))},xe=(a,...s)=>{ne();let l=a(...s);return ae(),l},V=(a,s)=>{if(ye(a)){let l=m(a);0&&console.log("UPDATE_CYCLE	","visiting   :	",l?.name);let I=s===!0?1:0;if(I<=0)for(let h of d(a)??[])V(h),I|=fe(h)??0;let p=I;p>=1&&(p=l?.run()??0,p>=1&&l.postrun&&ge(a)),Te(a,p),0&&console.log("UPDATE_CYCLE	",p>0?"propagating:	":p<0?"delaying    	":"blocking   :	",l?.name),p>=1?i(a)?.forEach(V):p<=-1&&te(a)}};this.addEdge=(a,s)=>{let l=i(a)??(c(a,new Set)&&i(a));l.has(s)||(l.add(s),d(s)?.add(a)||_(s,new Set([a])))},this.delEdge=void 0,this.newId=()=>(x(),++o),this.getId=m,this.setId=_e,this.delId=void 0,this.runId=a=>t<=0?(re(a),!0):(te(a),!1);let se=new Map,be=f(se),Ie=T(se);this.addClass=a=>{let s=this.getClass(a);return A(s,"create")},this.getClass=a=>{let s=be(a);return s||(s=a(this),Ie(a,s),s)},this.batch={startBatching:ne,endBatching:ae,scopedBatching:xe},this.dynamic={setValue:(a,s)=>{let l=m(a??0);l&&(l.value=s)},setEquals:(a,s)=>{let l=m(a??0);l&&(l.equals=s)},setFn:(a,s)=>{let l=m(a??0);l&&(l.fn=s)}}}};var g=n=>{let{newId:o,getId:t,setId:e,addEdge:r}=n;return class{constructor(d,{name:c,equals:_}={}){let u=o();e(u,this),this.id=u,this.rid=u,this.name=c,this.value=d,this.equals=_===!1?O:_??M}get(d){return d&&r(this.id,d),0&&le(t,this.id,d),this.value}set(d){let c=this.value;return!this.equals(c,this.value=typeof d=="function"?d(c):d)}run(){return 1}bindMethod(d){return A(this,d)}static create(...d){let c=new this(...d);return[c.id,c]}}},ve=n=>{let o=n.runId;return class extends n.getClass(g){constructor(e,r){super(e,r)}set(e){return super.set(e)?(o(this.id),!0):!1}static create(e,r){let i=new this(e,r);return[i.id,i.bindMethod("get"),i.bindMethod("set")]}}},Ke=n=>class extends n.getClass(g){constructor(t,e){super(e?.value,e),this.fn=t,e?.defer===!1&&this.get()}get(t){return this.rid&&(this.run(),this.rid=0),super.get(t)}run(){return super.set(this.fn(this.rid))?1:0}static create(t,e){let r=new this(t,e);return[r.id,r.bindMethod("get")]}},Ue=n=>class extends n.getClass(g){constructor(t,e){super(e?.value,e),this.fn=t,this.dirty=1,e?.defer===!1&&this.get()}run(){return this.dirty=1}get(t){return(this.rid||this.dirty)&&(super.set(this.fn(this.rid)),this.dirty=1,this.rid=0),super.get(t)}static create(t,e){let r=new this(t,e);return[r.id,r.bindMethod("get")]}},Ne=n=>{let o=n.runId;return class extends n.getClass(g){constructor(e,r){super(void 0,r),this.fn=e,r?.defer===!1&&this.set()}get(e){e&&(this.run(),super.get(e))}set(){return o(this.id)}run(){let e=this.fn(this.rid)!==!1;return this.rid&&(this.rid=0),e?1:0}static create(e,r){let i=new this(e,r);return[i.id,i.bindMethod("get"),i.bindMethod("set")]}}};var Z=n=>class extends n.getClass(g){constructor(t={},e){let r=k(t),i=r?[]:{},d=r?[...t.keys()]:B(t),c=r?[...t.values()]:q(t);super([i],e),this.setItems(d,c,!1)}postrun(){this.value.splice(1)}set(t,e,r){return this.setItems([t],[e],r)}setItems(t,e,r){let i=this.equals,d=this.value,c=d.length,_=d[0],u=t.length;for(let S=0;S<u;S++){let x=t[S],R=_[x],b=e[S],E=_[x]=typeof b=="function"?b(R):b;!i(R,E)&&d.push(x)}let C=d.length;return!r&&C-c>0}delete(t,e){return this.deleteKeys([t],e)}deleteKeys(t,e){let r=this.value,i=r.length,d=r[0];for(let _ of t)_ in d&&(delete d[_],r.push(_));let c=r.length;return!e&&c-i>0}},Fe=n=>{let o=n.runId;return class extends n.getClass(Z){setItems(e,r,i){return super.setItems(e,r,i)?o(this.id):!1}deleteKeys(e,r){return super.deleteKeys(e,r)?o(this.id):!1}static create(e={},r){let i=new this(e,r);return[i.id,i.bindMethod("get"),i.bindMethod("set"),i.bindMethod("setItems"),i.bindMethod("delete"),i.bindMethod("deleteKeys")]}}},Me=n=>class extends n.getClass(Z){constructor(t,e){super(e?.value,e),this.fn=t,e?.defer===!1&&this.get()}get(t){return this.rid&&(this.run(),this.rid=0),super.get(t)}run(){let[t,e,r=!0]=this.fn(this.rid);return r&&super.setItems(t,e)?1:0}static create(t,e){let r=new this(t,e);return[r.id,r.bindMethod("get")]}};})();
