"use strict";(()=>{var{from:Ne,isArray:G,of:Oe}=Array;var xe=String.fromCharCode,Le=Promise.resolve,{isInteger:we,MAX_VALUE:Ve,NEGATIVE_INFINITY:Be,POSITIVE_INFINITY:Ge}=Number,{assign:Ae,keys:P,getPrototypeOf:Ce,values:k}=Object,oe=Date.now,{iterator:Pe,toStringTag:ke}=Symbol;var q=()=>{};var x=r=>r.prototype;var u=(r,o,...t)=>e=>r[o].bind(e,...t);var A=(r,o,...t)=>r[o].bind(r,...t),j=x(Array),H=x(Map),v=x(Set);var Y=u(j,"pop"),M=u(j,"push");var z=u(j,"splice",0);var K=u(v,"add"),J=u(v,"clear"),W=u(v,"delete");var X=u(v,"has");var U=u(H,"clear");var f=u(H,"get");var g=u(H,"set");var F=Symbol("a rejection by a throttled function"),Q=(r,o)=>{let t=0;return(...e)=>{let n=oe();return n-t>r?(t=n,o(...e)):F}};var N=(r,o)=>r===o,O=(r,o)=>!1,Re=(r,o)=>{let t=o===!1?O:o??N,e=Q(r,t);return(n,i)=>{let d=e(n,i);return d===F?!0:d}},de=r=>{let o=r.length**.5;return r.reduce((t,e)=>t+e*(e+o),0)},le=0?(r,o,t)=>{let e=r(o),n=t?r(t):{name:"untracked"};console.log("GET:	",e.name,"	by OBSERVER:	",n.name,"	with VALUE	",e.value)}:q;var Z=class{addEdge;delEdge;newId;getId;setId;delId;runId;addClass;getClass;batch;dynamic;constructor(){let o=0,t=0,e=new Map,n=new Map,i=f(e),d=f(n),c=g(e),_=g(n),y=new Map,C=f(y),m=g(y),b=U(y),R=a=>{let s=new Set,l=K(s),D=X(s),p=h=>{D(h)||(l(h),i(h)?.forEach(p))};return a.forEach(p),s},I=(...a)=>{let s=de(a);return C(s)??(m(s,R(a))&&C(s))},E=new Map,S=f(E),_e=g(E),L=new Set,pe=K(L),ue=W(L),ye=J(L),w=new Map,fe=f(w),ge=g(w),Se=U(w),V=[],Te=M(V),me=Y(V),ee=[],te=M(ee),he=z(ee),ne=(...a)=>{ye(),Se(),I(...a).forEach(pe);for(let l of a)B(l,!0);0&&console.log("UPDATE_POSTRUNS:	",V);let s;for(;s=me();)S(s)?.postrun()},re=()=>++t,ae=()=>{--t<=0&&(t=0,ne(...he()))},be=(a,...s)=>{re();let l=a(...s);return ae(),l},B=(a,s)=>{if(ue(a)){let l=S(a);0&&console.log("UPDATE_CYCLE	","visiting   :	",l?.name);let D=s===!0?1:0;if(D<=0)for(let h of d(a)??[])B(h),D|=fe(h)??0;let p=D;p>=1&&(p=l?.run()??0,p>=1&&l.postrun&&Te(a)),ge(a,p),0&&console.log("UPDATE_CYCLE	",p>0?"propagating:	":p<0?"delaying    	":"blocking   :	",l?.name),p>=1?i(a)?.forEach(B):p<=-1&&te(a)}};this.addEdge=(a,s)=>{let l=i(a)??(c(a,new Set)&&i(a));l.has(s)||(l.add(s),d(s)?.add(a)||_(s,new Set([a])))},this.delEdge=void 0,this.newId=()=>(b(),++o),this.getId=S,this.setId=_e,this.delId=void 0,this.runId=a=>t<=0?(ne(a),!0):(te(a),!1);let se=new Map,Ie=f(se),De=g(se);this.addClass=a=>{let s=this.getClass(a);return A(s,"create")},this.getClass=a=>{let s=Ie(a);return s||(s=a(this),De(a,s),s)},this.batch={startBatching:re,endBatching:ae,scopedBatching:be},this.dynamic={setValue:(a,s)=>{let l=S(a??0);l&&(l.value=s)},setEquals:(a,s)=>{let l=S(a??0);l&&(l.equals=s)},setFn:(a,s)=>{let l=S(a??0);l&&(l.fn=s)}}}};var T=r=>{let{newId:o,getId:t,setId:e,addEdge:n}=r;return class{constructor(d,{name:c,equals:_}={}){let y=o();e(y,this),this.id=y,this.rid=y,this.name=c,this.value=d,this.equals=_===!1?O:_??N}get(d){return d&&n(this.id,d),0&&le(t,this.id,d),this.value}set(d){let c=this.value;return!this.equals(c,this.value=typeof d=="function"?d(c):d)}run(){return 1}bindMethod(d){return A(this,d)}static create(...d){let c=new this(...d);return[c.id,c]}}},Ee=r=>{let o=r.runId;return class extends r.getClass(T){constructor(e,n){super(e,n)}set(e){return super.set(e)?(o(this.id),!0):!1}static create(e,n){let i=new this(e,n);return[i.id,i.bindMethod("get"),i.bindMethod("set")]}}},ve=r=>class extends r.getClass(T){constructor(t,e){super(e?.value,e),this.fn=t,e?.defer===!1&&this.get()}get(t){return this.rid&&(this.run(),this.rid=0),super.get(t)}run(){return super.set(this.fn(this.rid))?1:0}static create(t,e){let n=new this(t,e);return[n.id,n.bindMethod("get")]}},Me=r=>class extends r.getClass(T){constructor(t,e){super(e?.value,e),this.fn=t,this.dirty=1,e?.defer===!1&&this.get()}run(){return this.dirty=1}get(t){return(this.rid||this.dirty)&&(super.set(this.fn(this.rid)),this.dirty=1,this.rid=0),super.get(t)}static create(t,e){let n=new this(t,e);return[n.id,n.bindMethod("get")]}},Ke=r=>{let o=r.runId;return class extends r.getClass(T){constructor(e,n){super(void 0,n),this.fn=e,n?.defer===!1&&this.set()}get(e){e&&(this.run(),super.get(e))}set(){return o(this.id)}run(){let e=this.fn(this.rid)!==!1;return this.rid&&(this.rid=0),e?1:0}static create(e,n){let i=new this(e,n);return[i.id,i.bindMethod("get"),i.bindMethod("set")]}}};var $=r=>class extends r.getClass(T){constructor(t={},e){let n=G(t),i=n?[]:{},d=n?[...t.keys()]:P(t),c=n?[...t.values()]:k(t);super([i],e),this.setItems(d,c,!1)}postrun(){this.value.splice(1)}set(t,e,n){return this.setItems([t],[e],n)}setItems(t,e,n){let i=this.equals,d=this.value,c=d.length,_=d[0],y=t.length;for(let m=0;m<y;m++){let b=t[m],R=_[b],I=e[m],E=_[b]=typeof I=="function"?I(R):I;!i(R,E)&&d.push(b)}let C=d.length;return!n&&C-c>0}delete(t,e){return this.deleteKeys([t],e)}deleteKeys(t,e){let n=this.value,i=n.length,d=n[0];for(let _ of t)_ in d&&(delete d[_],n.push(_));let c=n.length;return!e&&c-i>0}},Ue=r=>{let o=r.runId;return class extends r.getClass($){setItems(e,n,i){return super.setItems(e,n,i)?o(this.id):!1}deleteKeys(e,n){return super.deleteKeys(e,n)?o(this.id):!1}static create(e={},n){let i=new this(e,n);return[i.id,i.bindMethod("get"),i.bindMethod("set"),i.bindMethod("setItems"),i.bindMethod("delete"),i.bindMethod("deleteKeys")]}}},Fe=r=>class extends r.getClass($){constructor(t,e){super(e?.value,e),this.fn=t,e?.defer===!1&&this.get()}get(t){return this.rid&&(this.run(),this.rid=0),super.get(t)}run(){let[t,e,n=!0]=this.fn(this.rid);return n&&super.setItems(t,e)?1:0}static create(t,e){let n=new this(t,e);return[n.id,n.bindMethod("get")]}};})();
